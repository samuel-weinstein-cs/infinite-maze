<html>
	<canvas id="myCanvas" width="500" height="500" style="border:1px solid #000000;"></canvas>
	<script type="text/javascript">
			window.onerror=function(msg, url, linenumber){
			 alert('Error message: '+msg+'\nURL: '+url+'\nLine Number: '+linenumber)
			 return true
			}
	</script>
	<script src=http://cdnjs.cloudflare.com/ajax/libs/seedrandom/2.4.0/seedrandom.min.js></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script>
//alert('start!');
Array.prototype.containsArray = function(val) {
    var hash = {};
    for(var i=0; i<this.length; i++) {
        hash[this[i]] = i;
    }
    return hash.hasOwnProperty(val);
}
var c=document.getElementById("myCanvas");
var ctx=c.getContext("2d");
function randint(min, max){
 return Math.floor(Math.random() * (max - min + 1)) + min;
}
function floor(x){
	if (x>0){
		return Math.floor(x);
	} else {
		return Math.ceil(x);
	}
}
function dir(d){
	var x=0;
	var y=0;
	if (d==0){
		y=-1;
	}
	if (d==1){
		x=1;
	}
	if (d==2){
		y=1;
	}
	if (d==3){
		x=-1;
	}
	return [x, y];
}
function invd(d){
	if (d==0){
		d=2;
	}
	else if (d==1){
		d=3;
	}
	else if (d==2){
		d=0;
	}
	else if (d==3){
		d=1;
	}
	return d;
}
function generate(maze,x,y,closed){
	//draw(maze);
	var fin=false;
	var d=randint(0,3)
	if((y+dir(d)[1]>=0 && y+dir(d)[1]<=4) && (x+dir(d)[0]>=0 && x+dir(d)[0]<=4)){
		if(maze[y+dir(d)[1]][x+dir(d)[0]]=='0,0,0,0'){
			closed.push([x,y]);
			maze[y][x][d]=1;
			x+=dir(d)[0];
			y+=dir(d)[1];
			maze[y][x][invd(d)]=1;
		}
		var pop = false;
		//alert('got here');
		for (var i=0; i<=3; i++){
			if(!((y+dir(i)[1]>=0 && y+dir(i)[1]<=4) && (x+dir(i)[0]>=0 && x+dir(i)[0]<=4))){
				pop=true;
			} else {
				pop=false;
				
			}
			try
			{if(!(maze[y+dir(i)[1]][x+dir(i)[0]]=='0,0,0,0')){
				pop=true;
			} else {
				pop=false;
				break;
			}
			}catch(err){}
		}
		//alert(pop);
		try{
		if (pop == true){
			//alert(closed);
			x=closed[closed.length-1][0];
			y=closed[closed.length-1][1];
			closed.pop();
		}
		} catch(err) {
			fin=true;	
		}
	}
	return {maze : maze, x : x, y : y, closed : closed, fin : fin};
}
function doEdges(maze,x,y,l,s,e){
	var olu = createmaze(Math.floor((x+2)/5),Math.floor((y+2)/5),l+1,s,false);
    /*if(olu === undefined){alert(olu);}
	if(olu[2-(Math.floor((y+2)/5)*5-y)][2-(Math.floor((x+2)/5)*5-x)][0]==1){maze[0][2][0]=1;}
	if(olu[2-(Math.floor((y+2)/5)*5-y)][2-(Math.floor((x+2)/5)*5-x)][1]==1){maze[2][4][1]=1;}
	if(olu[2-(Math.floor((y+2)/5)*5-y)][2-(Math.floor((x+2)/5)*5-x)][2]==1){maze[4][2][2]=1;}
	if(olu[2-(Math.floor((y+2)/5)*5-y)][2-(Math.floor((x+2)/5)*5-x)][3]==1){maze[2][0][3]=1;}*/
    //alert(olu);
    //ctx.font="10px Arial";
    //ctx.clearRect(0, 0, c.width, c.height);
    //ctx.fillText(olu,10,25);
	return maze;
}
function createmaze(sx,sy,sl,s,e,ox,oy){
	var m=0;
	var seed = sx+' '+sy+' '+sl+' '+s;
	Math.seedrandom(seed);
	var x=randint(0,4);
	var y=randint(0,4);
	var closed=[];
	var i = 0;
	var maze=
[[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],
[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],
[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],
[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],
[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]];
	//draw(maze);
	//alert(i);
	setTimeout(jsuks(),1);
	function jsuks(){
	var gen=generate(maze,x,y,closed);
	maze=gen.maze;
	x=gen.x;  
	y=gen.y;
	closed=gen.closed;
	i++
	//draw(maze);
	if (gen.fin){
//document.writeln("gen'd: "+sx+' '+sy+' '+sl+'.');
		//draw(maze,sx,sy,ox,oy); 
		//alert(e+' '+sl);
		if(e){
			maze=doEdges(maze,sx,sy,sl,s,e);
		} 
		//document.writeln(maze+' sl '+sl);
		if (sl==0){
			draw(maze,sx,sy,ox,oy);
			//document.writeln("got here");
			//return(maze);
			
		}
		window.clearInterval(interval);
		return(maze);
;
		
	}
	var interval = setTimeout(jsuks(),1);
	}
	return jsuks();
	
}
//alert(createmaze(2,0,1,s,false));
///*
var x=0;
var y=0;
//var s=Math.random();
var s = "sam weinstein";
$(document).ready(function(){
	$(document).keydown(function(event){
    //document.write("hello");
    maze=createmaze(Math.floor((x+2)/5),Math.floor((y+2)/5),0,s,true,-x,-y);

        if(event.which==68){
        	x+=5;
        	//if((maze[2-(Math.floor((y+2)/5)*5-y)][2-(Math.floor((x+2)/5)*5-x)][1])==1){x+=1;}
        };
        if(event.which==65){
        	x-=5;
        	//if((maze[2-(Math.floor((y+2)/5)*5-y)][2-(Math.floor((x+2)/5)*5-x)][3])==1){x-=1;}
        };
        if(event.which==83){
        	y+=5;
        	//if((maze[2-(Math.floor((y+2)/5)*5-y)][2-(Math.floor((x+2)/5)*5-x)][2])==1){y+=1;}
        };
        if(event.which==87){
        	y-=5;
        	//if((maze[2-(Math.floor((y+2)/5)*5-y)][2-(Math.floor((x+2)/5)*5-x)][0])==1){y-=1;}
        }
        //var c=document.getElementById("myCanvas");
		var ctx=c.getContext("2d");
        ctx.clearRect(0, 0, c.width, c.height);
        maze=createmaze(Math.floor((x+2)/5),Math.floor((y+2)/5),0,s,true,-x,-y);
        createmaze(Math.floor((x+2)/5)+1,Math.floor((y+2)/5),0,s,true,-x,-y);
        createmaze(Math.floor((x+2)/5)-1,Math.floor((y+2)/5),0,s,true,-x,-y);
        createmaze(Math.floor((x+2)/5),Math.floor((y+2)/5)-1,0,s,true,-x,-y);
        createmaze(Math.floor((x+2)/5),Math.floor((y+2)/5)+1,0,s,true,-x,-y);
        createmaze(Math.floor((x+2)/5)+1,Math.floor((y+2)/5)+1,0,s,true,-x,-y);
        createmaze(Math.floor((x+2)/5)+1,Math.floor((y+2)/5)-1,0,s,true,-x,-y);
        createmaze(Math.floor((x+2)/5)-1,Math.floor((y+2)/5)+1,0,s,true,-x,-y);
        createmaze(Math.floor((x+2)/5)-1,Math.floor((y+2)/5)-1,0,s,true,-x,-y);
        
        ctx.fillText(Math.floor((x+2)/5)+' '+Math.floor((y+2)/5)+' olu: '+Math.floor((Math.floor((x+2)/5)+2)/5)+' '+Math.floor((Math.floor((y+2)/5)+2)/5),10,25);
        
    });
});
//createmaze(x,y,0,s,true,-x*5,-y*5);
/*
//*/
		
/*
//*/
function draw(m,x,y,ox,oy){
	x*=5
	y*=5
    siz=3;
	x+=ox+2.5*siz-2.5;
	y+=oy+2.5*siz-2.5;
	var size=100*(1/siz);
	//var w=size/2;
	var w=1;
	JSON.stringify(m);
	var c=document.getElementById("myCanvas");
	var ctx=c.getContext("2d");
	
    ctx.lineWidth = w;
    ctx.beginPath();
    ctx.strokeStyle="#000000";
    ctx.fillStyle="#000000";
	ctx.font = "30px Arial";
	//ctx.fillText(Math.floor((-ox+2)/5)+" "+Math.floor((-oy+2)/5),4,25)
	for (i=0; i<5; i++){
		for (j=0; j<5; j++){
			
			if (m[j][i][0]==0){
				ctx.moveTo(i*size-w/2+x*size,j*size+y*size);
				ctx.lineTo((i+1)*size+w/2+x*size,j*size+y*size);
			}
			ctx.stroke();
			if (m[j][i][1]==0){
				ctx.moveTo((i+1)*size+x*size,j*size-w/2+y*size);
				ctx.lineTo((i+1)*size+x*size,(j+1)*size+w/2+y*size);
			}
			ctx.stroke();
			if (m[j][i][2]==0){
				ctx.moveTo(i*size-w/2+x*size,(j+1)*size+y*size);
				ctx.lineTo((i+1)*size+w/2+x*size,(j+1)*size+y*size);
			}
			ctx.stroke();
			if (m[j][i][3]==0){
				ctx.moveTo(i*size+x*size,j*size-w/2+y*size);
				ctx.lineTo(i*size+x*size,(j+1)*size+w/2+y*size);
			}
			ctx.stroke();
		}
	}
    ctx.closePath();
	ctx.fillStyle=("#ff0000");
	//ctx.fillRect(226, 226, 48, 48);
    //ctx.fillRect(c.width/2, c.height/2,siz*98,siz*98)
}
	</script>
</html>
