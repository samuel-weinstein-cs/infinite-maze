<html>
	<canvas id="myCanvas" width="500" height="500" style="border:1px solid #000000;"></canvas>
	<script type="text/javascript">
			window.onerror=function(msg, url, linenumber){
			 alert('Error message: '+msg+'\nURL: '+url+'\nLine Number: '+linenumber)
			 return true
			}
	</script>
	<script src=http://cdnjs.cloudflare.com/ajax/libs/seedrandom/2.4.0/seedrandom.min.js></script>
	<script>
//alert('start!');
Array.prototype.containsArray = function(val) {
    var hash = {};
    for(var i=0; i<this.length; i++) {
        hash[this[i]] = i;
    }
    return hash.hasOwnProperty(val);
}
var c=document.getElementById("myCanvas");
var ctx=c.getContext("2d");
function randint(min, max){
 return Math.floor(Math.random() * (max - min + 1)) + min;
}
function floor(x){
	if (x>0){
		return Math.floor(x);
	} else {
		return Math.ceil(x);
	}
}
function dir(d){
	var x=0;
	var y=0;
	if (d==0){
		y=-1;
	}
	if (d==1){
		x=1;
	}
	if (d==2){
		y=1;
	}
	if (d==3){
		x=-1;
	}
	return [x, y];
}
function invd(d){
	if (d==0){
		d=2;
	}
	else if (d==1){
		d=3;
	}
	else if (d==2){
		d=0;
	}
	else if (d==3){
		d=1;
	}
	return d;
}
function generate(maze,x,y,closed){
	//draw(maze);
	var fin=false;
	var d=randint(0,3)
	if((y+dir(d)[1]>=0 && y+dir(d)[1]<=4) && (x+dir(d)[0]>=0 && x+dir(d)[0]<=4)){
		if(maze[y+dir(d)[1]][x+dir(d)[0]]=='0,0,0,0'){
			closed.push([x,y]);
			maze[y][x][d]=1;
			x+=dir(d)[0];
			y+=dir(d)[1];
			maze[y][x][invd(d)]=1;
		}
		var pop = false;
		//alert('got here');
		for (var i=0; i<=3; i++){
			if(!((y+dir(i)[1]>=0 && y+dir(i)[1]<=4) && (x+dir(i)[0]>=0 && x+dir(i)[0]<=4))){
				pop=true;
			} else {
				pop=false;
				
			}
			try
			{if(!(maze[y+dir(i)[1]][x+dir(i)[0]]=='0,0,0,0')){
				pop=true;
			} else {
				pop=false;
				break;
			}
			}catch(err){}
		}
		//alert(pop);
		try{
		if (pop == true){
			//alert(closed);
			x=closed[closed.length-1][0];
			y=closed[closed.length-1][1];
			closed.pop();
		}
		} catch(err) {
			fin=true;	
		}
	}
	return {maze : maze, x : x, y : y, closed : closed, fin : fin};
}
function doEdges(maze,x,y,l,s,e){
	//alert(createmaze(1,3,0,s));
	var olu=[];
	//alert(x+' '+y+' '+l);
	if((Math.floor(((x+2)+1)/5)!=Math.floor((x+2)/5))||(Math.floor(((x+2)-1)/5)!=Math.floor((x+2)/5))||(Math.floor(((y+2)+1)/5)!=Math.floor((y+2)/5))||(Math.floor(((y+2)-1)/5)!=Math.floor((y+2)/5))){
		olu=createmaze(Math.floor((x+2)/5),Math.floor((y+2)/5),l+1,s,true);//one level up
		//alert(olu);
		//alert('here');
	} else {
		//alert('there');
		olu=createmaze(Math.floor((x+2)/5),Math.floor((y+2)/5),l+1,s,false);
		//alert(olu);
	}
	/*alert(Math.floor((x+2)/5));
	alert(Math.floor((y+2)/5));
	alert(l+1);
	alert(s);*/
	for(i=0; i<=3; i++){
		//alert('got')
		if(olu[(y-Math.floor((y+2)/5)*5)+2][(Math.floor((x+2)/5)*5)+2][i]){
			//alert(x+' '+y);
			if(i==0){
				var otherx=x;
				var othery=y-1;
			}
			if(i==1){
				var otherx=x+1;
				var othery=y;
			}
			if(i==2){
				var otherx=x;
				var othery=y+1;
			}
			if(i==3){
				var otherx=x-1;
				var othery=y;
			}
			//alert(Math.sqrt(Math.pow(otherx,2)+Math.pow(othery,2))+' '+Math.sqrt(Math.pow(x,2)+Math.pow(y,2)))
			if(Math.sqrt(Math.pow(otherx,2)+Math.pow(othery,2))>Math.sqrt(Math.pow(x,2)+Math.pow(y,2)))
{
				seed=(i+' '+x+' '+y+' '+otherx+' '+othery+' '+l+' '+s);
				//alert('closer')
			} else {
				//alert('farther')
				seed=(invd(i)+' '+otherx+' '+othery+' '+x+' '+y+' '+l+' '+s);
			}
			
			//alert(seed);
			Math.seedrandom(seed);
			var point=randint(0,4);
			if(i==0){
				maze[0][point][i]=1;
			}
			if(i==1){
				maze[point][4][i]=1;
			}
			if(i==2){
				maze[4][point][i]=1;
			}
			if(i==3){
				maze[point][0][i]=1;
			}
		}
	}
	
	//alert(olu);
	//Math.seedrandom(x+' '+y+' '+l+' '+s+' n');
	//maze[0][randint(0,4)][0]=1;
	return maze;
}
function createmaze(sx,sy,sl,s,e,ox,oy){
	var m=0;
	var seed = sx+' '+sy+' '+sl+' '+s;
	Math.seedrandom(seed);
	var x=randint(0,4);
	var y=randint(0,4);
	var closed=[];
	var i = 0;
	var maze=
[[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],
[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],
[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],
[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],
[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]];
	//draw(maze);
	//alert(i);
	setTimeout(jsuks(),1);
	function jsuks(){
	var gen=generate(maze,x,y,closed);
	maze=gen.maze;
	x=gen.x;  
	y=gen.y;
	closed=gen.closed;
	i++
	//draw(maze);
	if (gen.fin){
document.writeln("gen'd: "+sx+' '+sy+' '+sl+'.');
		//draw(maze,sx,sy,ox,oy); 
		//alert(e+' '+sl);
if(sl==0){document.writeln(maze)};
		if(e){
			maze=doEdges(maze,sx,sy,sl,s,e);

		} 
		if (sl==0){
			draw(maze,sx,sy,ox,oy);
document.writeln("got here");
			//return(maze);
			
		}
		window.clearInterval(interval);
		return(maze);
;
		
	}
	var interval = setTimeout(jsuks(),1);
	}
	return jsuks();
	
}
//alert(createmaze(2,0,1,s,false));
///*

var s="j";
var x=1*5;
var y=0*5;
var c=document.getElementById("myCanvas");
var ctx=c.getContext("2d");
ctx.clearRect(0, 0, c.width, c.height);
ctx.font = "30px Arial";
ctx.fillText(Math.floor((x+2)/5)+" "+Math.floor((y+2)/5),4,25)
//createmaze(x,y,0,s,true,-x*5,-y*5);
createmaze(Math.floor((x+2)/5),Math.floor((y+2)/5),0,s,true,-x,-y);


/*

//*/
		
/*
//*/
function draw(m,x,y,ox,oy){
	x*=5
	y*=5
	x+=ox+5;
	y+=oy+5;
	var size=100*(1/3);
	//var w=size/2;
	var w=1;
	JSON.stringify(m);
	var c=document.getElementById("myCanvas");
	var ctx=c.getContext("2d");
	ctx.clearRect(0, 0, c.width, c.height);
ctx.font = "30px Arial";
ctx.fillText(Math.floor((-ox+2)/5)+" "+Math.floor((-oy+2)/5),4,25)
	for (i=0; i<5; i++){
		for (j=0; j<5; j++){
			ctx.lineWidth = w;
			if (m[j][i][0]==0){
				ctx.moveTo(i*size-w/2+x*size,j*size+y*size);
				ctx.lineTo((i+1)*size+w/2+x*size,j*size+y*size);
			}
			ctx.stroke();
			if (m[j][i][1]==0){
				ctx.moveTo((i+1)*size+x*size,j*size-w/2+y*size);
				ctx.lineTo((i+1)*size+x*size,(j+1)*size+w/2+y*size);
			}
			ctx.stroke();
			if (m[j][i][2]==0){
				ctx.moveTo(i*size-w/2+x*size,(j+1)*size+y*size);
				ctx.lineTo((i+1)*size+w/2+x*size,(j+1)*size+y*size);
			}
			ctx.stroke();
			if (m[j][i][3]==0){
				ctx.moveTo(i*size+x*size,j*size-w/2+y*size);
				ctx.lineTo(i*size+x*size,(j+1)*size+w/2+y*size);
			}
			ctx.stroke();
		}
	}
	ctx.fillStyle=("#ff0000");
	ctx.fillRect(234, 234, 32, 32);
}
	</script>
</html>
